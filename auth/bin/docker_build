#!/usr/bin/env bash
BIN="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PWD=$(pwd)
print="$BIN/../../shared/print"
source "$BIN"/SET

cd "$BIN" || exit

BUILD_TIMESTAMP=$( date '+%F_%H:%M:%S' )
$print "Building image $TAG with timestamp $BUILD_TIMESTAMP ..."

sed 's|__TEST_EHR__|'"$TEST_EHR"'|g; ' "$BIN"/ClientFhirServerRealm.sample.json > "$BIN"/ClientFhirServerRealm.json

docker build -f Dockerfile -t "$TAG" -t "$LATEST" --build-arg VERSION="$VERSION" --build-arg BUILD_TIMESTAMP="$BUILD_TIMESTAMP" .

$print "Created image $TAG" INFO

cd "$PWD" || exit