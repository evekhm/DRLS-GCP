#!/usr/bin/env bash
BIN="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PWD=$(pwd)
print="$BIN/../../shared/print"
source "$BIN"/SET

cd "$BIN"  || exit

$print "Building image $IMAGE:$VERSION ..."

sed 's|__TEST_EHR__|'"$TEST_EHR"'|g; ' "$BIN"/ClientFhirServerRealm.sample.json > "$BIN"/ClientFhirServerRealm.json
docker build -f Dockerfile -t "$IMAGE":"$VERSION" .
docker tag "${IMAGE}":"${VERSION}" "${IMAGE}":latest
$print "Created image ${IMAGE}:${VERSION}" INFO

cd "$PWD" || exit