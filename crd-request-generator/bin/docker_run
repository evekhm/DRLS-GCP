#!/usr/bin/env bash
BIN="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PWD=$(pwd)
source "$BIN"/SET


IMG_TAG="${IMAGE}":"${VERSION}"
if docker images "$IMG_TAG" | grep -q "$IMG_TAG"
then
  echo "Using already built image $IMG_TAG"
else
  "$BIN"/docker_build
fi

"$BIN"/docker_stop

echo "Running docker container $IMG_TAG for application $APPLICATION"
docker run -d -p 3000:3000 -p 3001:3001 --env-file "$BIN"/.env --label "$APPLICATION"  \
  -v /home/node/app/node_modules -v /home/node/app/databaseData "$IMAGE:$VERSION"